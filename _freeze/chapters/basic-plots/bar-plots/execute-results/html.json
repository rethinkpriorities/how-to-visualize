{
  "hash": "6681623721d5f4cdaf77d46ab9ecdad5",
  "result": {
    "engine": "knitr",
    "markdown": "---\nfig-format: svg\n---\n\n\n\n\n\n# Bar plots\n\n## Setup\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(scales)\n\nlighter_blue <- \"#BFE7F4\"\nlight_blue <- \"#7ED2F1\"\nblue <- \"#327291\"\nyellow <- \"#FBB21D\"\ndark_gray <- \"#303A40\"\ngray <- \"#464D53\"\n\ntheme_set(theme_minimal(base_size = 17))\nupdate_geom_defaults(\"bar\", aes(fill = blue))\nupdate_geom_defaults(\"text\", aes(color = \"gray20\"))\nupdate_geom_defaults(\"label\", aes(color = \"gray20\"))\n```\n:::\n\n\n\n\n\n## Frequencies\n\nBar plots are ideal for plotting frequencies. Although it is easy to create a simple bar plot, there are several things that can be done to improve on them:\n\n-   Order the categories in terms of their frequency\n-   Add frequency labels to make it easier to see the exact frequencies\n\nThere are two basic ways to construct a bar plot in `ggplot`. The first way is to use the raw data and have `ggplot` calculate the frequencies.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = fct_rev(fct_infreq(class)))) +\n  geom_bar() +\n  geom_label(\n    stat = \"count\",\n    mapping = aes(label = after_stat(count)),\n    vjust = 1,\n    color = \"white\",\n    fill = \"transparent\",\n    label.size = NA,\n    label.padding = unit(0.5, \"lines\")\n  ) +\n  labs(x = \"class\") +\n  guides(fill = \"none\") +\n  labs(x = \"test\") +\n  scale_y_continuous(expand = expansion(mult = c(0, 0.05))) +\n  theme(\n    panel.grid.major.x = element_blank()\n  )\n```\n\n::: {.cell-output-display}\n![Bar plot with counts calculated by ggplot2](bar-plots_files/figure-html/bar-plot-after-stat-counts-1.svg)\n:::\n:::\n\n\n\n\n\nIf you want to flip the order from high to low, remove the `fct_rev()` function from the code.\n\nThe second way is to first calculate the frequencies yourself and then use the resulting data frame to plot the frequencies.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounts <- count(mpg, class)\n\nggplot(counts, aes(x = reorder(class, n), y = n, fill = class)) +\n  geom_col(alpha = .85) +\n  geom_text(\n    mapping = aes(label = n),\n    vjust = -0.5,\n    color = \"grey20\",\n    size = 3\n  ) +\n  labs(x = \"class\", y = \"count\") +\n  guides(fill = \"none\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](bar-plots_files/figure-html/unnamed-chunk-3-1.svg)\n:::\n:::\n\n\n\n\n\n### Percentages\n\nIf you want to plot percentages instead, you can use the same two techniques as before: 1) have `ggplot` calculate the percentages or 2) do it yourself first.\n\nIf you want to have `ggplot` calculate a percentage, you can use `..count../sum(..count..)`.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = fct_rev(fct_infreq(class)), fill = class)) +\n  geom_bar(aes(y = after_stat(count / sum(count))), alpha = .85) +\n  geom_text(\n    mapping = aes(\n      label = percent(after_stat(count / sum(count))),\n      y = after_stat(count / sum(count))\n    ),\n    stat = \"count\",\n    vjust = -.5,\n    color = \"grey20\"\n  ) +\n  labs(x = \"class\") +\n  guides(fill = \"none\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](bar-plots_files/figure-html/unnamed-chunk-4-1.svg)\n:::\n:::\n\n\n\n\n\nAlternatively, you calculate the percentages yourself first.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounts <- mpg %>%\n  count(class) %>%\n  mutate(pct = n / sum(n))\n\nggplot(counts, aes(x = reorder(class, n), y = pct, fill = class)) +\n  geom_col(alpha = .85) +\n  geom_text(\n    mapping = aes(label = percent(pct)),\n    vjust = -0.5,\n    color = \"grey20\",\n    size = 3\n  ) +\n  labs(x = \"class\", y = \"count\") +\n  guides(fill = \"none\") +\n  scale_y_continuous(labels = percent_format(accuracy = 1)) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](bar-plots_files/figure-html/unnamed-chunk-5-1.svg)\n:::\n:::\n\n\n\n\n\nThe code of this latter approach seems to be a lot simpler, so could be recommended on that basis.\n\n### Stacked bar plots\n\nStacked bar plots can be used to add additional information to a bar plot, but they generally are difficult to interpret. It's difficult to assess the varying sizes of the stacked bar charts. Plotting Likert responses as a stacked bar char may be an exception, as long as it is accompanied by labeled percentages and rotated horizontally. See the Likert chapter for more information.\n\nUsually the better way to add additional information to a bar plot is to use faceting.\n",
    "supporting": [
      "bar-plots_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}